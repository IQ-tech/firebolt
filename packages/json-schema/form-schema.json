{
  "$id": "https://github.com/IQ-tech/firebolt",
  "$schema": "http://json-schema.org/draft-07/schema",
  "description": "This schema should be used to the creation and validation of Firebolt Forms JSON files",
  "required": [
    "$schema-version",
    "$experience-version",
    "flows",
    "steps",
    "name"
  ],
  "title": "The Firebolt form schema",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "$schema-version": {
      "$id": "#/properties/%24schema-version",
      "default": "",
      "description": "This version should match with the used Firebolt version",
      "examples": ["1.0.0", "0.0.1"],
      "title": "schema version",
      "type": "string"
    },
    "$experience-version": {
      "$id": "#/properties/%24experience-version",
      "default": "",
      "description": "The Version of the Experience",
      "examples": ["1.0.0", "0.0.1"],
      "title": "experience version",
      "type": "string"
    },
    "name": {
      "$id": "#/properties/name",
      "default": "",
      "description": "Name of the JSON form",
      "examples": ["sample"],
      "title": "Experience name",
      "type": "string"
    },
    "description": {
      "$id": "#/properties/description",
      "default": "",
      "description": "Description of the current JSON",
      "examples": ["sample json for tests"],
      "title": "Experience description",
      "type": "string"
    },
    "category": {
      "$id": "#/properties/category",
      "description": "This field requires a keyword to categorize the form",
      "examples": ["sample", "loans", "auth"],
      "title": "Experience category",
      "type": "string"
    },
    "decisionHandlerConfig": {
      "$id": "#/properties/decisionHandlerConfig",
      "description": "While transitioning steps, firebolt can execute a middleware called decision handler, with this function the developer can modify the natural flow of the experience, process incoming data...",
      "examples": [
        {
          "strategy": "remote",
          "triggers": "all",
          "saveProcessedData": "all",
          "remoteConfig": {
            "url": "url",
            "headers": {
              "Content-Type": "application/json",
              "Authorization": "Bearer "
            }
          }
        }
      ],
      "required": ["strategy", "triggers"],
      "title": "Decision handler config",
      "additionalProperties": false,
      "type": "object",
      "properties": {
        "strategy": {
          "$id": "#/properties/decisionHandler/properties/strategy",
          "default": null,
          "description": "strategy: This property should blablabla....",
          "examples": [
            "remote",
            "local"
          ],
          "title": "Decision handling strategy",
          "type": "string",
          "enum": ["remote", "local"]
        },
        "triggers": {
          "$id": "#/properties/decisionHandler/properties/triggers",
          "default": "underfined",
          "description": "This property should receive an array of objects contain the step slug and an boolean value to say if the processedData must be saved on localStorage, then, the decisionHandler calls will happen on transitioning from these steps.",
          "examples": [
            {
              "slug": "personal_data",
              "saveProcessedData": true
            }
          ],
          "title": "The triggers schema",
          "type": "array",
          "minItems": 1,
          "items": {
            "$id": "#/properties/decisionHandler/properties/triggers/items",
            "type": "object"
          }
        },
        "saveProcessedData": {
          "$id": "#/properties/decisionHandler/properties/saveProcessedData",
          "default": "underfined",
          "description": "saveProcessedData: This property blablabla etc...",
          "examples": [
            {
              "saveProcessedData": "all"
            }
          ],
          "title": "The saveProcessedData schema",
          "type": "string"
        },
        "remoteConfig": {
          "$id": "#/properties/decisionHandler/properties/remoteConfig",
          "default": null,
          "description": "remoteConfig: This property should blablabla....",
          "examples": [
            {
              "remoteConfig": {
                "url": {
                  "$id": "#/properties/decisionHandler/properties/url",
                  "default": "",
                  "description": "url to be used on decisionHandler calls (between step transitions)",
                  "examples": ["http://my-api-url.com/endpoint/"],
                  "title": "decisionHandler url",
                  "type": "string"
                },
                "headers": {
                  "$id": "#/properties/decisionHandler/properties/headers",
                  "type": "object",
                  "additionalProperties": true,
                  "title": "form headers",
                  "description": "headers to be used with decisionHandler calls",
                  "examples": [
                    {
                      "Content-Type": "application/json",
                      "Authorization": "Bearer "
                    }
                  ]
                }
              }
            }
          ],
          "title": "The remoteConfig schema",
          "type": "object"
        }
      }
    },
    "flows": {
      "$id": "#/properties/flows",
      "description": "Flows are the possible flows that can be performed during a form completion experience. the form process will use only one flow at time, but the firebolt api can change the flow of a form on the process.",
      "examples": [
        [
          {
            "slug": "default",
            "stepsSlugs": ["personal_data", "documents", "address", "bills"]
          },
          {
            "slug": "medium",
            "stepsSlugs": ["personal_data", "documents", "token"]
          }
        ]
      ],
      "title": "Form Flows",
      "minItems": 1,
      "additionalItems": true,
      "type": "array",
      "items": {
        "$id": "#/properties/flows/items",
        "anyOf": [
          {
            "$id": "#/properties/flows/items/anyOf/flowItem",
            "description": "At least a default flow is required",
            "examples": [
              {
                "slug": "default",
                "stepsSlugs": ["personal_data", "documents", "address", "bills"]
              }
            ],
            "required": ["slug", "stepsSlugs"],
            "title": "any flow",
            "type": "object",
            "properties": {
              "slug": {
                "$id": "#/properties/flows/items/anyOf/flowItem/properties/slug",
                "description": "An identifier to the flow, every form should have a default flow",
                "examples": ["default", "alternative-flow"],
                "title": "Slug of the flow",
                "type": "string"
              },
              "stepsSlugs": {
                "$id": "#/properties/flows/items/anyOf/flowItem/properties/stepsSlugs",
                "description": "The list of steps that this flow should have, this array contains a list of steps slugs",
                "examples": [["personal_data", "documents"]],
                "title": "Flow steps list",
                "type": "array",
                "additionalItems": true,
                "items": {
                  "$id": "#/properties/flows/items/anyOf/flowItem/properties/stepsSlugs/items",
                  "anyOf": [
                    {
                      "$id": "#/properties/flows/items/anyOf/flowItem/properties/stepsSlugs/items/anyOf/0",
                      "type": "string",
                      "title": "The first anyOf schema",
                      "description": "",
                      "default": "",
                      "examples": ["personal_data", "documents"]
                    }
                  ]
                }
              }
            },
            "additionalProperties": false
          }
        ]
      }
    },
    "steps": {
      "$id": "#/properties/steps",
      "description": "Here we can define the possible steps that the form can have",
      "title": "The steps list of the form",
      "type": "array",
      "minItems": 1,
      "additionalItems": true,
      "items": {
        "$id": "#/properties/steps/items",
        "anyOf": [
          {
            "$id": "#/properties/steps/items/anyOf/0",
            "default": {},
            "description": "An explanation about the purpose of this instance.",
            "examples": [
              {
                "step": {
                  "slug": "personal_data",
                  "type": "form",
                  "friendlyname": "Let's begin",
                  "fields": [
                    {
                      "slug": "full_name",
                      "ui:widget": "Text",
                      "ui:props": {
                        "label": "Full Name",
                        "placeholder": "Type your full name"
                      },
                      "validators": [
                        {
                          "type": "required"
                        },
                        {
                          "type": "name"
                        }
                      ]
                    },
                    {
                      "slug": "email",
                      "ui:widget": "Email",
                      "ui:props": {
                        "label": "Email",
                        "placeholder": "contact@email.com"
                      },
                      "validators": [
                        {
                          "type": "required"
                        },
                        {
                          "type": "email"
                        }
                      ]
                    }
                  ]
                }
              }
            ],
            "required": ["step"],
            "title": "A step config",
            "type": "object",
            "properties": {
              "step": {
                "$id": "#/properties/steps/items/anyOf/0/properties/step",
                "default": {},
                "description": "Here we can define the config for the current step",
                "examples": [
                  {
                    "slug": "personal_data",
                    "type": "form",
                    "friendlyname": "Let's begin",
                    "fields": [
                      {
                        "slug": "full_name",
                        "ui:widget": "Text",
                        "ui:props": {
                          "label": "Full Name",
                          "placeholder": "John doe"
                        },
                        "validators": [
                          {
                            "type": "required"
                          },
                          {
                            "type": "name"
                          }
                        ]
                      },
                      {
                        "slug": "email",
                        "ui:widget": "Email",
                        "ui:props": {
                          "label": "Email",
                          "placeholder": "contato@email.com"
                        },
                        "validators": [
                          {
                            "type": "required"
                          },
                          {
                            "type": "email"
                          }
                        ]
                      }
                    ]
                  }
                ],
                "required": ["slug", "type", "friendlyname"],
                "title": "The Step schema",
                "type": "object",
                "properties": {
                  "slug": {
                    "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/slug",
                    "description": "An unique identifier to this step",
                    "examples": ["personal_data", "address_data"],
                    "title": "Step slug",
                    "type": "string"
                  },
                  "type": {
                    "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/type",
                    "description": "Should be 'form' or 'custom', is used to distiguish between a regular form step or a custom step that should not have field validations",
                    "examples": ["form"],
                    "title": "Form step title",
                    "type": "string"
                  },
                  "friendlyname": {
                    "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/friendlyname",
                    "description": "this property is used to define a friendly display name to the step",
                    "examples": ["Lets Begin", "Type yout address..."],
                    "title": "The friendlyname schema",
                    "type": "string"
                  },
                  "fields": {
                    "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields",
                    "description": "Used to define the list of fields inside a step, is not required in custom steps",
                    "examples": [
                      [
                        {
                          "slug": "full_name",
                          "ui:widget": "Text",
                          "ui:props": {
                            "label": "Nome completo",
                            "placeholder": "Nome completo"
                          },
                          "validators": [
                            {
                              "type": "required"
                            },
                            {
                              "type": "name"
                            }
                          ]
                        },
                        {
                          "slug": "email",
                          "ui:widget": "Email",
                          "ui:props": {
                            "label": "Email",
                            "placeholder": "contato@email.com"
                          },
                          "validators": [
                            {
                              "type": "required"
                            },
                            {
                              "type": "email"
                            }
                          ]
                        }
                      ]
                    ],
                    "title": "The fields schema",
                    "type": "array",
                    "additionalItems": true,
                    "minItems": 1,
                    "items": {
                      "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items",
                      "anyOf": [
                        {
                          "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0",
                          "default": {},
                          "description": "Used to display a field in the form",
                          "examples": [
                            {
                              "slug": "full_name",
                              "ui:widget": "Text",
                              "ui:props": {
                                "label": "Nome completo",
                                "placeholder": "Nome completo"
                              },
                              "validators": [
                                {
                                  "type": "required"
                                },
                                {
                                  "type": "name"
                                }
                              ],
                              "meta": {}
                            }
                          ],
                          "required": ["slug", "ui:widget", "ui:props"],
                          "title": "The first anyOf schema",
                          "type": "object",
                          "properties": {
                            "slug": {
                              "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/slug",
                              "description": "An unique identifier to the field",
                              "examples": [
                                "full_name",
                                "zipcode",
                                "street_address"
                              ],
                              "title": "Field slug",
                              "type": "string"
                            },
                            "ui:widget": {
                              "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Awidget",
                              "default": "Text",
                              "description": "The Widget (firebolt-client component) that should be used on render the form. check the firebolt client to see the available widgets. custom widgets can be used with custom firebolt-client themes",
                              "examples": ["Text", "Select", "Check"],
                              "title": "UI Widget",
                              "type": "string"
                            },
                            "ui:props": {
                              "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Aprops",
                              "default": {},
                              "description": "Any value that can be passed right to the UI Widgets (components), values like label, placeholde, options, etc. these options are defined by the theme used by the front-end app",
                              "examples": [
                                {
                                  "label": "Nome completo",
                                  "placeholder": "Nome completo"
                                }
                              ],
                              "title": "Field UI props",
                              "type": "object",
                              "additionalProperties": true
                            },
                            "ui:props-preset": {
                              "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Aprops-preset",
                              "type": ["string", "array"],
                              "title": "UI props preset",
                              "description": "Used to apply a preset of props to a field Widget",
                              "examples": ["br-cep", "month-year"]
                            },
                            "ui:props-conditional": {
                              "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Aprops-conditional",
                              "type": "array",
                              "minItems": 1,
                              "title": "UI props conditional",
                              "additionalItems": true,
                              "description": "Conditionally add properties to a widget",
                              "examples": [
                                {
                                  "conditional": "step.document_issuer === '31'",
                                  "props": {
                                    "options": [
                                      {
                                        "value": "DETRAN",
                                        "label": "DEPARTAMENTO ESTADUAL DE TRANSITO"
                                      },
                                      {
                                        "value": "DNT",
                                        "label": "DEPARTAMENTO NACIONAL DE TRANSITO"
                                      }
                                    ]
                                  }
                                }
                              ],
                              "items": {
                                "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Aprops-conditional/items",
                                "anyOf": [
                                  {
                                    "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Aprops-conditional/items/anyOf/0",
                                    "type": "object",
                                    "additionalProperties": false,
                                    "required": ["conditional", "props"],
                                    "title": "UI prop conditional item",
                                    "properties": {
                                      "conditional": {
                                        "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Aprops-conditional/items/anyOf/0/properties/conditional",
                                        "title": "UI prop conditional",
                                        "description": "receive a conditional expression, if evaluated truthy on the fron-end, then the props will be passed to the field widget",
                                        "type": "string",
                                        "example": [
                                          "step.full_name === 'carlos alberto'"
                                        ]
                                      },
                                      "props": {
                                        "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Aprops-conditional/items/anyOf/0/properties/props",
                                        "title": "UI props conditional props",
                                        "type": "object",
                                        "additionalProperties": true,
                                        "description": "can have any properties inside"
                                      }
                                    }
                                  }
                                ]
                              }
                            },
                            "ui:styles": {
                              "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Astyles",
                              "title": "UI styles key",
                              "description": "used to modify certain aspects of the fields presentation, such as size",
                              "type": "object",
                              "additionalProperties": true,
                              "properties": {
                                "size": {
                                  "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/ui%3Astyles/size",
                                  "description": "Set field horizontal size on UI",
                                  "title": "field size",
                                  "enum": ["half", "full"],
                                  "type": "string"
                                }
                              }
                            },
                            "conditional": {
                              "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/conditional",
                              "type": "string",
                              "title": "Conditional field",
                              "description": "receives a logical expression, if false the field won't be rendered or validated",
                              "examples": [
                                "step.marital_status === '07' || step.marital_status === '06'"
                              ]
                            },
                            "validators": {
                              "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/validators",
                              "description": "Used to defined wich validators should be applied to the field, these validators can run on the client app or in the server",
                              "examples": [
                                [
                                  {
                                    "type": "required"
                                  },
                                  {
                                    "type": "name"
                                  }
                                ]
                              ],
                              "title": "Fields validators configuration",
                              "type": "array",
                              "additionalItems": true,
                              "items": {
                                "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/validators/items",
                                "anyOf": [
                                  {
                                    "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/validators/items/anyOf/0",
                                    "type": "object",
                                    "title": "The first anyOf schema",
                                    "description": "An explanation about the purpose of this instance.",
                                    "default": {},
                                    "examples": [
                                      {
                                        "type": "required"
                                      }
                                    ],
                                    "required": ["type"],
                                    "properties": {
                                      "type": {
                                        "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/validators/items/anyOf/0/properties/type",
                                        "description": "here we can pass the validator name, check firebolt validators lib to se the supported validators",
                                        "examples": ["required"],
                                        "title": "Validator name",
                                        "type": "string"
                                      },
                                      "properties": {
                                        "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/validators/items/anyOf/0/properties/properties",
                                        "description": "Any property that should be passed to the validator",
                                        "title": "Validator properties",
                                        "type": "object",
                                        "additionalProperties": true
                                      },
                                      "context": {
                                        "$id": "#/properties/steps/items/anyOf/0/properties/step/properties/fields/items/anyOf/0/properties/validators/items/anyOf/0/properties/context",
                                        "description": "Specify the context when the validator should be used",
                                        "type": "string",
                                        "enum": ["client", "server"]
                                      }
                                    }
                                  }
                                ]
                              }
                            }
                          },
                          "additionalProperties": false
                        }
                      ]
                    }
                  }
                },
                "additionalProperties": false
              }
            },
            "additionalProperties": true
          }
        ]
      }
    }
  }
}
